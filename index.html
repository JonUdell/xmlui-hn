<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="xmlui/0.7.25.js"></script>
    <script src="xmlui/xmlui-charts.js"></script>
    <script>
        window.xmluiHost = 'http://hn.jonudell.info/xmlui-hn'
        window.recent = function(limit) {
            const query = "select id, replace(substr(time,0,11),'-','/') as time, title, by, score, descendants, url from hn where url is not null order by score desc limit __LIMIT__ "
            return query.replace('__LIMIT__', limit)
        }
        window.mentions = function(names, days) {
            const query = "WITH RECURSIVE names(name, remaining) AS ( SELECT '', '__NAMES__' UNION ALL SELECT substr(remaining, 1, instr(remaining, ',') - 1), substr(remaining, instr(remaining, ',') + 1) FROM names WHERE remaining != '' ), counts AS ( SELECT name, ( SELECT COUNT(*) FROM hn WHERE LOWER(title) LIKE '%' || LOWER(names.name) || '%' AND (julianday('now') - julianday(datetime(substr(time, 1, 19)))) * 24 * 60 BETWEEN 0 AND __DAYS__ *1440 AND time IS NOT NULL ) AS mentions FROM names WHERE name != '' ) SELECT name, mentions FROM counts WHERE mentions > 0 ORDER BY mentions DESC;".replace('__NAMES__', names).replace('__DAYS__',days)
            
            return query
        };
        window.mentionNames = {
            "company" : "apple,google,microsoft,spacex,tesla,facebook,",
            "language" : "javascript,rust,html,python,typescript,sql,css,"
        }
        window.sql = {
            "stories": { "sql": "select count(*) as value from hn" },
            "days": { "sql": "select count(distinct substr(time, 1, 10)) as value from hn" },
            "askhn": { "sql": "select count(*) as value from hn where title like '%Ask HN%'" },
            "showhn": { "sql": "select count(*) as value from hn where title like '%Show HN%'" },
            "oldest": { "sql": "select substr(min(time),0,11) as value from hn" },
            "newest": { "sql": "select substr(max(time),0,11) as value from hn" },
            "maxscore": { "sql": "select max(score) as value from hn" },
            "companymentions7": { "sql": window.mentions(window.mentionNames.company, 7) },
            "companymentions30": { "sql": window.mentions(window.mentionNames.company , 30) },
            "languagementions7": { "sql": window.mentions(window.mentionNames.language ,7) },
            "languagementions30": { "sql": window.mentions(window.mentionNames.language ,30) },
            "recent50": { "sql": window.recent(50)}
        }
    </script>
</head>

<body>
</body>

</html>